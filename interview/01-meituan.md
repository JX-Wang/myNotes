美团面试经历
===

## 网申

提交了简历pdf,还填了一些基本信息.我记得不是内推.

## 电话预约

3.7,小姐姐电话约了面试时间:3.9,14:00.

## 电话一面

关键词 `mmap`,`malloc`

3.9,14:11.聊了30分钟.

* 面试官  `基本信息我都了解了,直接说你掌握了哪些技能,做了什么项目`

* 我 很快说了基本技能:语言层面,数据库层面,开发环境层面等.

* 我 说了DNS-detect项目,条理不是很清晰

* 面试官 `项目意义在哪里?人家已经有了ali dns可用,为什么还需要你来发现一大批DNS?怎么使用输出结果?`

* 我 内部需要,数据倒卖等.

* 面试官 不是很满意,他认为项目的驱动力不是很好.

* 我 准备说剩下的两个小demo,他好象是打断了,没让说下去.我也觉得没必要说这个,在他眼里可能就是个垃圾....

* 面试官 `C用的多吗`

* 我 `不多,但看过很多源码.`

* 面试官 `我知道你看了linux内核,你是怎么看得?只看书还是有其他的?`

* 我 `书加源码剖析,自己给内核打注释.一般流程是:罗列出问题清单,在把问题集中化,选择一块来研究,结合书和源码.`

* 面试官 `说说mmap的用途在哪里` 

* 我 瞎说了(大批量数据共享什么的),本来就没仔细研究mmap.其实应该是(引用[这里](https://www.cnblogs.com/huxiao-tee/p/4660352.html)):
	* 加快文件访问.因为普通write/read要经历内核-页高速缓存-用户空间,mmap是内核=用户空间,是一种更高效的内核与进程的交互.
	* 提供进程间共享内存及相互通信的方式。不管是父子进程还是无亲缘关系的进程，都可以将自身用户空间映射到同一个文件或匿名映射到同一片区域。从而通过各自对映射区域的改动，达到进程间通信和进程间共享的目的。
	* 可用于实现高效的大规模数据传输。内存空间不足，是制约大数据操作的一个方面，解决方案往往是借助硬盘空间协助操作，补充内存的不足。但是进一步会造成大量的文件I/O操作，极大影响效率。这个问题可以通过mmap映射很好的解决。换句话说，但凡是需要用磁盘空间代替内存的时候，mmap都可以发挥其功效。
	* 实现了用户空间和内核空间的高效交互方式。两空间的各自修改操作可以直接反映在映射的区域内，从而被对方空间及时捕捉。

* 面试官 不是很满意.`说说malloc细节,malloc调用大概经历了什么系统调用`

* 我 说了chunk,arena,do_brk等,其实还有mmap的...

* 面试官 `malloc出来的内存什么时候归还给内核`

* 我 不记得了,是在家里看得,已经过了半个多月.只好说,进程推出的时候,内核会检查引用计数什么的

* 面试官 `要是进程free了2G的内存,又不退出,内存就不还给内核?`

* 我 感觉自己脑子抽了,之前居然没说这个,我说我不记得了,我**推测**:malloc有一层缓存机制,如果free后,空闲的内存比较多并且相对连续,应该会直接给内核;否则,应该会自己维护,给后来的malloc调用使用.真正的实现细节在[这里](https://sourceware.org/glibc/wiki/MallocInternals#Free_Algorithm),总结就是:
	* 如果内存块太小,就放到fastbins链表数组里.
	* 如果内存块(chunk)是mmap获得的,直接unmmap掉.
	* 试图合并内存块
	* 合并之后,如果内存块很大,有可能会归还给内核.注意,这一步可以被推迟,等到下次malloc时才归还.

* 面试官 `能实习到什么时候`

* 我 9或者10月之前

* 面试官 `对什么部门感兴趣`

* 我 `高并发的部门吧.`

* 面试官 `你不是研究DNS的吗`

* 我 `额...`

* 面试官 `有什么问题吗`

* 我 问他部门并发大吗

* 面试官 大.说不是我想的那样,不是用什么linux原生api,有自己的一套框架.

* 我 还需要学什么

* 面试官 `多学习学校里面的基础.最好问题导向,虽然知道vector的细节,看过各种源码对实践有好处,但都是人家做好了的东西.要知道为什么需要这些,解决问题的痛点在哪里,为什么这样设计,细节是一辈子都学不完的.`

* 我 谢谢.

* 面试官 意犹未尽,接着说了点上面一段相关的事情.

* 我 什么时候知道结果

* 面试官 内部有一套流程,他也不知道,他只是了解一些情况,填到系统.后续可能还会有一些事情.

* 我 谢谢,没问题了.结束

总体感觉回答的一般.面试官的印象可能是:对linux内核有一定研究,但不怎么问题导向.这也是今后需要努力的方向,不能只看实现细节,只为了面试而准备.

本来以为是视频面试什么的,还准备了电脑,结果只是个电话面试.没想到面试官懂内核,真是卧虎藏龙.表现不好,我感觉mmap和malloc这么基本的都答不上,基本gg.

美团招聘官网上,投递记录里暂时没有什么变化.

## 二面

3.13约的二面,我给放到了3.16,周五,上午11点.

这是第三次面试了.经过第一次美团一面的教训,第二次阿里一面的顺利,已经有点小膨胀了,所以全程很有自信,谈笑风声.

面试官很nice,问问题很有逻辑,就是全程抓着项目,看你的迭代流程,探索精神,改进欲望等.

主要就是这几个问题:

* 大概说说你的项目,不用太详细,我知道你的一面情况.

正中我下怀,我那个项目虽然没什么高达上的东西,但在迭代上还可以说出个一二三四.我大概说了每次迭代解决什么问题,怎么想到的解决方案,效果如何.

他挺满意的,感觉.

* 是不是一个人做的?

是的.

* 有过协同开发的经历吗?

有,说了信息安全大赛的事儿.

* 为啥学内核?

这问题简直是为我准备的.我说之前那个项目遇到了奇怪的问题,所以想研究下.

* 为什么学2.6.11内核?看了那些书?

我说因为资料多,也具有大多数现在还流行的特性(epoll等).看的书就不说了,反正就是一顿吹吧.

* 你看内核的时候,遇到那些锁?

嘿嘿.当年操作系统,我自己看了本外国教材,啃的差不多了.锁,信号量,条件变量都研究过,还大概看过内核的同步控制设施.

又是一顿吹:自旋锁,读写锁,futex等.

* 知道锁怎么实现的吗?

到这里,我是真的觉得,面试官专挑我研究过的东西问.锁的实现在国外教材上有详细的剖析.

大体就是依赖于CPU提供原子性的指令,比如`CompareAndSet`,`TestAndSwap`,`FetchAndAdd`等.

* 收数据包大概是个什么流程?越底层越好

我就说了DMA,专用内存,中断,系统调用,socket缓冲区,socket hash表,内核空间/用户空间.

这个问题其实很大,可以充分反映面试者的实力,最能看出来你的底子好不好,基础扎不扎实,可塑性高不高.

我没什么准备,所以说的也不是很详细,不过对这个面试官足够了,毕竟前面的问题已经给他留下了好印象.

如果没事干,可以自己梳理下这个问题.展开的话,怕又是一片万字长文.

* CPU乱序执行指令,对你的程序有什么影响?

当时有点蒙了,怎么这么底层..

我感觉是体系结构的知识.我介绍了在stackoverflow上看到一个问题:[CPU的分支预测](https://stackoverflow.com/questions/11227809/why-is-it-faster-to-process-a-sorted-array-than-an-unsorted-array),这是我大一暑假看到的一个东西.

* 电话面没法让你写代码,不知道你代码能力怎么样.我最后说个小算法问题,你看看怎么实现:两个数组,各找一个元素,使得他们的差的绝对值最小.

是个面试常问题.可我不会.

那就老套路呗,先排序,再动态规划.

他也没说什么,到这里他其实不用问这个问题,因为我们聊得很开心,沟通起来不费劲.问这个怕是因为程序流程问题,我觉得影响不大.


* 对那个方向感兴趣?想去哪个部门?

并发量高的部门吧,锻炼人.他就开始说自己的部门,感觉是个搞流量分发的,涉及到的挺杂:网管,虚拟化,数据库,上层业务什么的.

我谁没问题.毕竟当初投的是基础平台开发,一面面试官给我很深的印象,功底非常扎实.

然后就是我问问题了.我就问了后续还有几轮,这时候我已经很自信了,都没问会不会被刷.他说应该就剩HR了,等着吧.


全程56分钟,算是我目前面过最久的.下午5 6点,就有美团的人打电话过来约HR面试,我感觉效率挺高的.