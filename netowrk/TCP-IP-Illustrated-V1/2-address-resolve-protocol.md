地址解析协议(ARP)

# ARP的用途

IP地址可以标记主机在网络层的软件位置,但是数据包的传输还需要知道硬件位置,需要知道这个数据包到底应该从哪个网络接口发出去,以及发到哪个网络接口.

也就是说,网络层的数据包需要告诉链路曾,数据包应该发给谁.简单来说,就是需要标明主机的物理地址:以太网地址.

在实际数据包的传输过程中，主机必须根据IP地址来确定，目的主机是不是和自己在同一个网段中，

* 如果是，则只需要向这个网段发送多播ARP请求，获取使用目的IP地址的主机的物理地址(MAC地址)，再直接向目标物理地址发送数据包
* 如果不是，数据包需要交给本网段的路由器去发送，路由器将根据自己的路由表，来选择数据包的下一个目的位置(MAC地址)。通常下一个位置是另一台路由器。

可以说，ARP的主要功能就是：**提供IP地址和MAC地址的相互转换**。

# ARP缓存

ARP是运行在主机或路由器上的一个协议，这个协议由特定的进程来维护,用以支持IP地址和MAC地址的转换。

如果要保证协议能高速完成任务，就需要设立缓存这一概念。每个ARP协议运行实体，都会维护一份ARP缓存表，类似与DNS的缓存。荣过```arp```命令就可观察到主机的ARP缓存。

一般一台家用主机的arp缓存表较小，因为主机主要是跟网关(路由器)直接通信，所以需要网关的物理地址;对于同一子网的其他主机，一般没有直接的通信需要。

对于路由器，arp缓存就可能比较大。

通过tcpdump可以观察到你的主机跟当前网段的arp协议交互。

# 代理ARP

可用于两个网络互相隐藏。

# 免费ARP

就是一台主机向子网内询问与自己的IP地址相同的主机的物理地址。正常情况下，不存在一个子网内有两台主机使用相同的IP地址。所以这个技术一般用与主机的开机检查，主机通过免费ARP来检查，自己的IP地址是否与子网内的某个主机冲突。

这个技术也可以用于更新网段内所有主机的ARP缓存，特别是当本主机换了MAC地址(使用其他的网络接口，或者直接换了网卡)。

# ARP欺骗

就是主机把错误的IP-MAC映射信息传播到子网内。一般可以被识别出来。